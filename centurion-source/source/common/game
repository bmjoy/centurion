#pragma once 

#include <gui>
#include <json.hpp>
#include <object>

using namespace std;
using namespace glm;

class Surface;
class Player;

namespace game {
	
	class UIGame;

	using namespace unit;
	using namespace building;

	// global game variables  --> see source/game/game_functions.cpp

	extern bool gameMenuStatus;
	extern bool gameMinimapStatus;
	extern bool gameGridStatus;
	extern int mapWidth, mapHeight;
	extern int playersNumber;
	extern int maxPlayersNumber;
	extern float cameraMovespeed;
	extern int currentZoomCamera;
	extern float zoomCameraFactor;
	extern float townhallRadius;
	extern bool selRectangleIsActive;
	extern int selectedUnits;

	extern map<int, Building> buildings;
	extern map<int, Unit> units;

	extern vector<Player> playersList;

	//
	//	GAME CLASS --> source/game/game.cpp
	//

	class Game {
	public:
		Game();
		bool game_is_created() { return gameIsCreated; }
		void reset();
		void create();
		void run();
		void clear();
		gui::Rectangle selRectangle;
		~Game();
	private:
		Surface *surface;
		UIGame *ui;
		//double lastTime;
		float threshold, cameraLastX, cameraLastY;
		bool blockMinimap;
		/*int click_id;*/
		json settl_data;
		string r;
		vec2 origin;
		mat4 view, projection;
		bool gameIsCreated;
	};
	
	static Game mygame;
	Game *GAME(); // --> definition in game_functions.cpp

	//
	// GAME FUNCTIONS --> source/game/game_functions.cpp
	//
	
	struct SelRectPoints {
		float startX, startY, lastX, lastY;
		float minX, maxX, minY, maxY; 
	};

	static SelRectPoints selRectCoords;
	SelRectPoints *SelRectCoords();
	static float cameraToX = 0.f, cameraToY = 0.f;
	static float cameraLastX = 0.f;
	static float cameraLastY = 0.f;

	void renderObjectsPicking(bool *blockMinimap);
	void tracing(Surface *s);
	void clearBuffers();
	void goToPosition(bool *blockMinimap);
	void renderObjects();
	void renderSelRectangle();
	void setMinimapProjection();
};
